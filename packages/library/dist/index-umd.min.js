!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).RouteTransition=e()}(this,(function(){"use strict";function t(t,e,n){if(!e.has(t))throw new TypeError("attempted to "+n+" private field on non-instance");return e.get(t)}function e(e,n){return function(t,e){return e.get?e.get.call(t):e.value}(e,t(e,n,"get"))}function n(t,e,n){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.set(t,n)}function i(e,n,i){return function(t,e,n){if(e.set)e.set.call(t,n);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=n}}(e,t(e,n,"set"),i),i}var r=new WeakMap;class o{emit(t,n){e(this,r)[t]&&e(this,r)[t].forEach((t=>{t(n)}))}on(t,n){e(this,r)[t]||(e(this,r)[t]=[]),e(this,r)[t].push(n)}off(t,n){if(t)if(n||void 0===e(this,r)[t]){if(void 0!==e(this,r)[t]&&n instanceof Function){const i=e(this,r)[t].indexOf(n);i>-1&&e(this,r)[t].splice(i,1)}}else e(this,r)[t]=[];else i(this,r,{})}constructor(){n(this,r,{writable:!0,value:void 0}),i(this,r,{})}}function s(t){var e;const n=null===(e=t.querySelector("title"))||void 0===e?void 0:e.textContent;return null==n?null:n}function a(t){return t instanceof HTMLElement}function l(t){let e;if("number"!=typeof t&&(null==t?void 0:t.min)&&(null==t?void 0:t.max)){e=function(t,e){return Math.random()*(e-t)+t}(t.min,t.max)}else"number"==typeof t&&(e=t);return e}function u(t,e=0){const n=Math.pow(10,e);return Math.round(t*n)/n}function c(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}class h extends Error{constructor(t,e,n){super(`${t}\n  class: ${n}`),c(this,"element",void 0),c(this,"animationClass",void 0),this.name=this.constructor.name,this.element=e,this.animationClass=n}}function f(t,e,n,i,r,o,s){try{var a=t[o](s),l=a.value}catch(t){return void n(t)}a.done?e(l):Promise.resolve(l).then(i,r)}function d(t){return function(){var e=this,n=arguments;return new Promise((function(i,r){var o=t.apply(e,n);function s(t){f(o,i,r,s,a,"next",t)}function a(t){f(o,i,r,s,a,"throw",t)}s(void 0)}))}}function p(t,e){if(Array.isArray(t))for(const n of t)if(null==n?void 0:n.animation)e({animation:n.animation});else if(Array.isArray(null==n?void 0:n.all))for(const t of n.all)e({animation:t})}function v(){return(v=d((function*(t){return new Promise((e=>{t.addEventListener("finish",(()=>{e()}),{once:!0})}))}))).apply(this,arguments)}function w(){return w=d((function*(t){const e=t.getAnimations();if(!e.length)return Promise.resolve();const n=e.map((t=>function(t){return v.apply(this,arguments)}(t)));return yield Promise.all(n),Promise.resolve()})),w.apply(this,arguments)}function m(){return m=d((function*(t){return function(t,e){t.classList.add(e.class),null!=e.duration&&(t.style.setProperty("animation-duration",`${e.duration}ms`),t.style.setProperty("transition-duration",`${e.duration}ms`)),null!=e.delay&&(t.style.setProperty("animation-delay",`${e.delay}ms`),t.style.setProperty("transition-delay",`${e.delay}ms`))}(t.el,t),function(t){return w.apply(this,arguments)}(t.el)})),m.apply(this,arguments)}function y(t,e,n,i,r,o,s){try{var a=t[o](s),l=a.value}catch(t){return void n(t)}a.done?e(l):Promise.resolve(l).then(i,r)}function b(t){return function(){var e=this,n=arguments;return new Promise((function(i,r){var o=t.apply(e,n);function s(t){y(o,i,r,s,a,"next",t)}function a(t){y(o,i,r,s,a,"throw",t)}s(void 0)}))}}function k(t,e,n){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return n}function g(t,e){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.add(t)}function S(t){return function(t){return m.apply(this,arguments)}(function(t){const e={class:t.class,el:t.el};return t.duration&&(e.duration=u(l(t.duration),3)),t.delay&&(e.delay=u(l(t.delay),3)),e}(t))}var E=new WeakSet;class W extends o{animate(){var t=this;return b((function*(){if(Array.isArray(t.process))for(const n of t.process){var e;if((null==n?void 0:n.animation)&&a(null==n||null===(e=n.animation)||void 0===e?void 0:e.el))yield k(t,E,P).call(t,n.animation);else if(Array.isArray(null==n?void 0:n.all)){const e=[];for(const i of n.all)a(null==i?void 0:i.el)&&e.push(k(t,E,P).call(t,i));yield Promise.all(e)}}}))()}clearImmediate(){this.process&&p(this.process,(({animation:t})=>{var e,n,i;a(null==t?void 0:t.el)&&(n=(e=t).el,i=e.class,n.classList.remove(i),n.style.setProperty("animation-duration",null),n.style.setProperty("animation-delay",null),n.style.setProperty("transition-duration",null),n.style.setProperty("transition-delay",null))}))}constructor(t){var e,n,i;super(),g(this,E),i=void 0,(n="process")in(e=this)?Object.defineProperty(e,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[n]=i,this.process=null==t?void 0:t.process}}function P(t){return T.apply(this,arguments)}function T(){return(T=b((function*(t){const e={el:t.el};try{const n=S(t);this.emit("animation-start",e),yield n,this.emit("animation-end",e)}catch(e){var n;const i=null!==(n=null==e?void 0:e.message)&&void 0!==n?n:e;throw new h(i,t.el,t.class)}}))).apply(this,arguments)}const M=".rt-action-link",j={linkSelector:M,contentSelector:"#rt-content",animation:{elSelector:".rt-el-animation",in:{beforeClass:"rt-el-animation-before-in",class:"rt-el-animation-in"},out:{class:"rt-el-animation-out"}}};function x(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}class A extends Error{constructor(t,e){super("Href not found"),x(this,"element",void 0),x(this,"selector",void 0),this.name=this.constructor.name,this.element=t,this.selector=e}}function C(t,e,n){if(!e.has(t))throw new TypeError("attempted to "+n+" private field on non-instance");return e.get(t)}function L(t,e){return function(t,e){return e.get?e.get.call(t):e.value}(t,C(t,e,"get"))}function O(t,e,n){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.set(t,n)}function H(t,e,n){return function(t,e,n){if(e.set)e.set.call(t,n);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=n}}(t,C(t,e,"set"),n),n}function $(t,e){return function(t,e){if(e.set){if(!e.get)throw new TypeError("attempted to read set only private field");return"__destrWrapper"in e||(e.__destrWrapper={set value(n){e.set.call(t,n)},get value(){return e.get.call(t)}}),e.__destrWrapper}if(!e.writable)throw new TypeError("attempted to set read only private field");return e}(t,C(t,e,"update"))}var z=new WeakMap,_=new WeakMap,q=new WeakMap;class B{add(t){L(this,z).push(t),$(this,_).value++,L(this,z).length>L(this,q)&&(L(this,z).shift(),$(this,_).value--)}get(t){var e;return null!==(e=L(this,z).at(t))&&void 0!==e?e:null}get current(){return L(this,z)[L(this,_)]}get length(){return L(this,z).length}backward(){return L(this,_)<=0?null:($(this,_).value--,L(this,z)[L(this,_)])}forward(){return L(this,_)>=L(this,z).length-1?null:($(this,_).value++,L(this,z)[L(this,_)])}clear(){H(this,z,[]),H(this,_,-1)}constructor(t){O(this,z,{writable:!0,value:[]}),O(this,_,{writable:!0,value:-1}),O(this,q,{writable:!0,value:void 0}),H(this,q,(null==t?void 0:t.maxLength)||3)}}function I(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}function D(t,e,n){if(!e.has(t))throw new TypeError("attempted to "+n+" private field on non-instance");return e.get(t)}function F(t,e){return function(t,e){return e.get?e.get.call(t):e.value}(t,D(t,e,"get"))}function R(t,e,n){I(t,e),e.set(t,n)}function G(t,e,n){return function(t,e,n){if(e.set)e.set.call(t,n);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=n}}(t,D(t,e,"set"),n),n}function J(t,e,n){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return n}function K(t,e){I(t,e),e.add(t)}var N=new WeakMap,Q=new WeakMap,U=new WeakMap,V=new WeakSet,X=new WeakSet,Y=new WeakSet,Z=new WeakSet,tt=new WeakSet,et=new WeakSet;class nt extends o{run(){J(this,V,it).call(this)}destroy(){J(this,X,rt).call(this)}goBack(){const t=F(this,N).backward();t&&history.pushState({},"",t)}constructor(t){var e,n,i;super(),K(this,V),K(this,X),K(this,Y),K(this,Z),K(this,tt),K(this,et),i=void 0,(n="linkSelector")in(e=this)?Object.defineProperty(e,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[n]=i,R(this,N,{writable:!0,value:void 0}),R(this,Q,{writable:!0,value:void 0}),R(this,U,{writable:!0,value:void 0}),this.linkSelector=(null==t?void 0:t.linkSelector)||M,G(this,Q,J(this,et,lt).bind(this)),G(this,U,J(this,Z,st).bind(this)),G(this,N,new B),F(this,N).add(window.location.href)}}function it(){document.addEventListener("click",F(this,Q)),window.addEventListener("popstate",F(this,U))}function rt(){document.removeEventListener("click",F(this,Q)),window.removeEventListener("popstate",F(this,U))}function ot(t){return!!this.linkSelector&&(!!t&&t.matches(this.linkSelector))}function st(t){J(this,tt,at).call(this,{type:"popstate",nativeEvent:t,toHref:window.location.href,fromHref:F(this,N).current})}function at(t){F(this,N).add(t.toHref),this.emit("action",t)}function lt(t){const e=t.target.closest(this.linkSelector);if(!J(this,Y,ot).call(this,e))return;t.preventDefault();const n=e.getAttribute("href");if(n)history.pushState({},"",n),J(this,tt,at).call(this,{type:"link-click",nativeEvent:t,target:e,toHref:n,fromHref:F(this,N).current||window.location.href});else{const t=new A(e,this.linkSelector);this.emit("error",t)}}class ut extends Error{constructor(t){var e,n,i;super(),i=void 0,(n="response")in(e=this)?Object.defineProperty(e,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[n]=i,this.name=this.constructor.name,this.response=t}}function ct(t,e,n,i,r,o,s){try{var a=t[o](s),l=a.value}catch(t){return void n(t)}a.done?e(l):Promise.resolve(l).then(i,r)}function ht(t){return function(){var e=this,n=arguments;return new Promise((function(i,r){var o=t.apply(e,n);function s(t){ct(o,i,r,s,a,"next",t)}function a(t){ct(o,i,r,s,a,"throw",t)}s(void 0)}))}}function ft(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}function dt(t,e,n){if(!e.has(t))throw new TypeError("attempted to "+n+" private field on non-instance");return e.get(t)}function pt(t,e){return function(t,e){return e.get?e.get.call(t):e.value}(t,dt(t,e,"get"))}function vt(t,e,n){return function(t,e,n){if(e.set)e.set.call(t,n);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=n}}(t,dt(t,e,"set"),n),n}var wt=new WeakMap,mt=new WeakSet;class yt extends o{stop(){pt(this,wt)&&pt(this,wt).abort()}load(t){var e=this;return ht((function*(){try{vt(e,wt,new AbortController);const n=yield fetch(t,{signal:pt(e,wt).signal});if(n.ok)return function(t,e,n){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return n}(e,mt,bt).call(e,n);throw new ut(n)}finally{vt(e,wt,null)}}))()}constructor(t){var e,n;super(),ft(e=this,n=mt),n.add(e),function(t,e,n){e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n}(this,"selector",void 0),function(t,e,n){ft(t,e),e.set(t,n)}(this,wt,{writable:!0,value:void 0}),this.selector=t.selector}}function bt(t){return kt.apply(this,arguments)}function kt(){return(kt=ht((function*(t){const e=yield t.text(),n=document.createElement("html");n.innerHTML=e;return{contentElement:n.querySelector(`${this.selector}`),documentTitle:s(n)}}))).apply(this,arguments)}function gt(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}class St extends Error{constructor(t,e){super(`Content not found by selector ${t} in phase ${e}`),gt(this,"selector",void 0),gt(this,"phase",void 0),this.name=this.constructor.name,this.selector=t,this.phase=e}}function Et(t){var e;return null!=t&&"Object"===(null==t||null===(e=t.constructor)||void 0===e?void 0:e.name)}function Wt(t){if(Array.isArray(t))return[...t];if(!Et(t))return t;const e={};return Object.keys(t).forEach((n=>{e[n]=Wt(null==t?void 0:t[n])})),e}function Pt(t,e){if(!Et(t))return;Object.keys(e).forEach((n=>{n in t?Et(e[n])&&Pt(t[n],e[n]):t[n]=e[n]}))}function Tt(t){const e=Wt(null!=t?t:{});return Pt(e,j),e}function Mt(t,e){var n,i,r;return{el:t.el,class:null!==(n=t.class)&&void 0!==n?n:e.class,duration:null!==(i=t.duration)&&void 0!==i?i:e.duration,delay:null!==(r=t.delay)&&void 0!==r?r:e.delay}}function jt(t,e){const n=[];return t.forEach((t=>{if(null==t?void 0:t.animation){const i=Mt(t.animation,e);n.push({animation:i})}else if(Array.isArray(null==t?void 0:t.all)){const i=[];t.all.forEach((t=>{const n=Mt(t,e);i.push(n)})),n.push({all:i})}})),n}function xt(t,e,n,i,r,o,s){try{var a=t[o](s),l=a.value}catch(t){return void n(t)}a.done?e(l):Promise.resolve(l).then(i,r)}function At(t){return function(){var e=this,n=arguments;return new Promise((function(i,r){var o=t.apply(e,n);function s(t){xt(o,i,r,s,a,"next",t)}function a(t){xt(o,i,r,s,a,"throw",t)}s(void 0)}))}}function Ct(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}function Lt(t,e,n){if(!e.has(t))throw new TypeError("attempted to "+n+" private field on non-instance");return e.get(t)}function Ot(t,e){return function(t,e){return e.get?e.get.call(t):e.value}(t,Lt(t,e,"get"))}function Ht(t,e,n){Ct(t,e),e.set(t,n)}function $t(t,e,n){return function(t,e,n){if(e.set)e.set.call(t,n);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=n}}(t,Lt(t,e,"set"),n),n}function zt(t,e,n){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return n}function _t(t,e){Ct(t,e),e.add(t)}var qt=new WeakMap,Bt=new WeakMap,It=new WeakMap,Dt=new WeakMap,Ft=new WeakMap,Rt=new WeakMap,Gt=new WeakMap,Jt=new WeakSet,Kt=new WeakSet,Nt=new WeakSet,Qt=new WeakSet,Ut=new WeakSet,Vt=new WeakMap,Xt=new WeakSet,Yt=new WeakSet,Zt=new WeakSet,te=new WeakSet,ee=new WeakSet,ne=new WeakSet,ie=new WeakSet,re=new WeakSet,oe=new WeakSet,se=new WeakSet,ae=new WeakSet,le=new WeakSet,ue=new WeakMap,ce=new WeakSet,he=new WeakMap;function fe(){$t(this,Rt,document.querySelector(this.options.contentSelector))}function de(){return[...document.querySelectorAll(`${this.options.animation.elSelector}`)]}function pe(t){return function({els:t,options:e,phase:n}){const i=[],r=[];return t.forEach((t=>{const i={el:t,class:e.animation[n].class,duration:e.animation[n].duration,delay:e.animation[n].delay};r.push(i)})),i.push({all:r}),i}({els:t,options:this.options,phase:Ot(this,Ft)})}function ve(t){t.classList.add(this.options.animation.in.beforeClass)}function we(t){t.classList.remove(this.options.animation.in.beforeClass)}function me(t){return ye.apply(this,arguments)}function ye(){return(ye=At((function*(t){return Ot(this,Gt)&&Ot(this,It).stop(),Ot(this,It).load(t.toHref).then((t=>{if(!a(t.contentElement))throw new St(this.options.contentSelector,"in");return this.emit("load",t),t}))}))).apply(this,arguments)}function be(t){var e,n;zt(this,Zt,ke).call(this,null===(e=t.contentElement)||void 0===e?void 0:e.outerHTML),this.emit("insert",t),null!=t.documentTitle&&(n=t.documentTitle,document.title=n)}function ke(t){Ot(this,Rt).outerHTML=t}function ge(){if(zt(this,Jt,fe).call(this),!Ot(this,Rt))throw new St(this.options.contentSelector,"out");const t=zt(this,Kt,de).call(this);return{contentEl:Ot(this,Rt),animatedEls:t}}function Se({phase:t,els:e}){Array.isArray(Ot(this,qt))?$t(this,qt,jt(Ot(this,qt),this.options.animation[t])):$t(this,qt,zt(this,Nt,pe).call(this,e)),Ot(this,Dt).process=Ot(this,qt)}function Ee(){return We.apply(this,arguments)}function We(){return(We=At((function*(){return Ot(this,Dt).animate()}))).apply(this,arguments)}function Pe(t){return Te.apply(this,arguments)}function Te(){return(Te=At((function*(t){$t(this,Ft,t);const{animatedEls:e}=zt(this,te,ge).call(this);this.emit("process",{animatedEls:e,phase:Ot(this,Ft)}),"in"===t&&zt(this,se,Ce).call(this),zt(this,ee,Se).call(this,{phase:t,els:e}),yield zt(this,ne,Ee).call(this),$t(this,qt,null)}))).apply(this,arguments)}function Me(){return je.apply(this,arguments)}function je(){return(je=At((function*(){yield zt(this,ie,Pe).call(this,"in"),Ot(this,Dt).clearImmediate()}))).apply(this,arguments)}function xe(){return Ae.apply(this,arguments)}function Ae(){return(Ae=At((function*(){yield zt(this,ie,Pe).call(this,"out")}))).apply(this,arguments)}function Ce(){Ot(this,qt)&&p(Ot(this,qt),(({animation:t})=>{a(null==t?void 0:t.el)&&zt(this,Qt,ve).call(this,t.el)}))}function Le(t){return Oe.apply(this,arguments)}function Oe(){return(Oe=At((function*(t){const e=yield Promise.allSettled([zt(this,Xt,me).call(this,t),zt(this,oe,xe).call(this)]);if("rejected"===e[0].status)throw e[0].reason;if("rejected"===e[1].status)throw e[1].reason;return e[0].value}))).apply(this,arguments)}function He(t){this.emit("error",t)}function $e(t){var e;zt(this,le,He).call(this,t),t instanceof ut&&404===(null===(e=t.response)||void 0===e?void 0:e.status)&&Ot(this,Bt).goBack(),location.reload()}return class extends o{run(){Ot(this,Bt).run(),Ot(this,Bt).on("action",Ot(this,he)),Ot(this,Bt).on("error",Ot(this,ue)),Ot(this,Dt).on("animation-start",Ot(this,Vt))}destroy(){Ot(this,Bt).off(),Ot(this,Bt).destroy(),Ot(this,It).off(),Ot(this,Dt).off()}setProcess(t){Array.isArray(t)?$t(this,qt,jt(t,this.options.animation[Ot(this,Ft)])):$t(this,qt,null)}getPhase(){return Ot(this,Ft)}constructor(t){var e,n,i;super(),_t(this,Jt),_t(this,Kt),_t(this,Nt),_t(this,Qt),_t(this,Ut),_t(this,Xt),_t(this,Yt),_t(this,Zt),_t(this,te),_t(this,ee),_t(this,ne),_t(this,ie),_t(this,re),_t(this,oe),_t(this,se),_t(this,ae),_t(this,le),_t(this,ce),i=void 0,(n="options")in(e=this)?Object.defineProperty(e,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[n]=i,Ht(this,qt,{writable:!0,value:void 0}),Ht(this,Bt,{writable:!0,value:void 0}),Ht(this,It,{writable:!0,value:void 0}),Ht(this,Dt,{writable:!0,value:void 0}),Ht(this,Ft,{writable:!0,value:void 0}),Ht(this,Rt,{writable:!0,value:void 0}),Ht(this,Gt,{writable:!0,value:void 0}),Ht(this,Vt,{writable:!0,value:t=>{a(null==t?void 0:t.el)&&zt(this,Ut,we).call(this,t.el)}}),Ht(this,ue,{writable:!0,value:t=>{Ot(this,Gt)||(zt(this,le,He).call(this,t),$t(this,Gt,!1))}});var r,o=this;Ht(this,he,{writable:!0,value:(r=At((function*(t){if(!Ot(o,Gt))try{$t(o,Gt,!0),o.emit("action",t);const e=yield zt(o,ae,Le).call(o,t);zt(o,Yt,be).call(o,e),yield zt(o,re,Me).call(o),o.emit("complete")}catch(t){zt(o,ce,$e).call(o,t)}finally{$t(o,Gt,!1)}})),function(t){return r.apply(this,arguments)})}),this.options=Tt(t),$t(this,Bt,new nt({linkSelector:this.options.linkSelector})),$t(this,It,new yt({selector:this.options.contentSelector})),$t(this,Dt,new W)}}}));
